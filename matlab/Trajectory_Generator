%% Testing the trajectory generation and post processing for the path
clear
clc
close all


%Defining Start and End Points for [x,y]
start = [2000, 0];         %start point coordinates in mm
target = [2000, 5000];     %Target point coordinates in mm


% Different variants of obstacles may be considered for demonstration purposes
%obstacles = [1900 1600; 2300 1900; 2050 2000; 1800 2700; 2100 3500];
obstacles = [1700 1600; 2300 1900; 2050 2000; 1800 2300; 3500 3500]; %Obstacles Coordinates
figure(1)


% Generate collision-free path
[path, vectors, vectors_len, path_len] = generatePath(start,target, obstacles);
path=path/1000                        %Path points in meter
path_size=size(path,1);               %Size of the obtained path array

        
%taking a point every 50 points
number_of_points=8                            %Number of Via Points taken from the path
step=floor(path_size/number_of_points)         %step taking in the path array
maximum_limit=step*number_of_points            %Maximum limit using this step size

path_x=zeros((number_of_points+2),1)
path_y=zeros((number_of_points+2),1)

path_x(1)=path(1,1)
path_y(1)=path(1,2)

path_x(end)=path(end,1)
path_y(end)=path(end,2)

for i=step:step:maximum_limit
    path_x((i/step)+1)=path(i,1)
    path_y((i/step)+1)=path(i,2)
end

figure(1)
plot(path(:,1),path(:,2),'LineWidth',2.5)
hold on
plot((obstacles(:,1)/1000),(obstacles(:,2)/1000),'o','MarkerSize',10)
hold on
%plot(path_x,path_y,'s','MarkerEdgeColor','black','MarkerSize',10)
grid on
title('Path Planned in X-Y Coordinates','FontSize',12)
xlabel('X Coordinate in m','FontSize',12,'FontWeight','bold','Color','r')
ylabel('Y Coordinate in m','FontSize',12,'FontWeight','bold','Color','r')
legend('Planned Path','Obstacles','Via Points')

jj=size(path_x,1)
x_d=zeros(1,jj)
x_dd=x_d
y_d=x_d
y_dd=x_d
[a1] = trajectory_blend_quintic(path_x',20,1);   %Coefficients of X coordinate
[a2] = trajectory_blend_quintic(path_y',20,2);   %Coefficients of Y coordinate


csvwrite('myfile.csv',a1)
csvwrite('myfile2.csv',a2)
